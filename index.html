<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>送迎予定チェック</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    #inputArea {
      width: 90%;
      height: 150px;
    }
    table {
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 4px 8px;
    }
    .error {
      background-color: #ffdcdc;
    }
  </style>
</head>
<body>
  <h1>送迎予定チェック</h1>
  <p>1) Excelで表をコピー (Ctrl+C) して、2) 下の枠に貼り付け (Ctrl+V) → 3) 「解析」ボタンを押す</p>
  
  <textarea id="inputArea" placeholder="ここにExcelの表を貼り付けてください"></textarea><br><br>
  <button onclick="parseData()">解析</button>

  <div id="tableContainer"></div>

  <script>
    function parseData() {
      const text = document.getElementById("inputArea").value.trim();
      if (!text) {
        alert("テキストが空です。Excelの表をコピーして貼り付けてください。");
        return;
      }
      
      // 改行で行に分割
      const lines = text.split(/\r?\n/);
      
      // テーブルを組み立てるHTMLを作る
      let tableHtml = "<table>";
      lines.forEach((line, rowIndex) => {
        // タブ区切りで列に分割 (Excelからのコピーは基本的にタブ区切り)
        const cols = line.split("\t");
        tableHtml += "<tr>";
        cols.forEach((col, colIndex) => {
          // 1行目をヘッダ行にする例 (任意で調整)
          if (rowIndex === 0) {
            tableHtml += `<th>${col}</th>`;
          } else {
            tableHtml += `<td>${col}</td>`;
          }
        });
        tableHtml += "</tr>";
      });
      tableHtml += "</table>";
      
      // テーブル表示
      document.getElementById("tableContainer").innerHTML = tableHtml;
      
      // --- ここからチェック機能(サンプル) ---
      //   例： 「お迎え時刻」 < 「リスン到着時刻」でなければエラーにする 等
      //   まずは列の位置を特定する (1行目のヘッダを参照)
      
      const table = document.querySelector("#tableContainer table");
      if (!table) return;
      
      // ヘッダ行(0行目)の列見出しを取得
      const headerCells = table.rows[0].cells;
      let idxPickup = -1;
      let idxArrive = -1;
      
      for (let i = 0; i < headerCells.length; i++) {
        const headerText = headerCells[i].textContent.trim();
        if (headerText === "お迎え時刻") idxPickup = i;
        if (headerText === "リスン到着") idxArrive = i;
      }
      
      // 必要な列が見つからなければチェックをスキップ
      if (idxPickup === -1 || idxArrive === -1) {
        console.log("チェック対象の列が見つかりませんでした。");
        return;
      }
      
      // 2行目以降(= table.rows[1] 以降)をチェック
      for (let r = 1; r < table.rows.length; r++) {
        const row = table.rows[r];
        const pickupText = row.cells[idxPickup].textContent.trim();
        const arriveText = row.cells[idxArrive].textContent.trim();
        
        // 時刻を数値(1300 → 13:00相当)にして比較する簡易例
        // （実際にはもう少し厳密な変換が必要かも）
        const pickupNum = parseInt(pickupText, 10);
        const arriveNum = parseInt(arriveText, 10);
        
        // 例：お迎え時刻 > リスン到着時刻 ならエラー扱い
        if (!isNaN(pickupNum) && !isNaN(arriveNum)) {
          if (pickupNum > arriveNum) {
            // 背景色を変えてエラー表示
            row.cells[idxPickup].classList.add("error");
            row.cells[idxArrive].classList.add("error");
          }
        }
      }
    }
  </script>
</body>
</html>
