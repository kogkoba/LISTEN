<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>デイサービスお迎えシミュレーション</title>
  <style>
    /* ページ全体のスタイル */
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    h1 {
      text-align: center;
    }

    /* Excelを貼り付ける領域 */
    #pasteArea {
      border: 2px dashed #666;
      padding: 8px;
      width: 80%;
      min-height: 200px;
      margin: 0 auto;
      outline: none;
    }

    /* ボタン */
    #parseButton {
      display: block;
      margin: 10px auto;
      padding: 6px 12px;
      cursor: pointer;
    }

    /* Canvasの見た目 */
    #gameCanvas {
      display: block;
      margin: 20px auto;
      background: #eee;
    }
  </style>
</head>
<body>
  <h1>デイサービスお迎えシミュレーション</h1>

  <!-- Excelの表をペーストする場所 -->
  <p style="text-align:center;">
    Excelの表をコピーして、下の枠に貼り付けてください。
  </p>
  <div id="pasteArea" contenteditable="true">
    ここにExcelの表をペースト
  </div>

  <!-- 解析ボタン -->
  <button id="parseButton">表を解析してシミュレーションに反映</button>

  <!-- ゲーム用Canvas -->
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <script>
    // 「表を解析してシミュレーションに反映」ボタンをクリックしたときの処理
    document.getElementById("parseButton").addEventListener("click", () => {
      // 貼り付けたHTMLを取得
      const pasteArea = document.getElementById("pasteArea");
      const pastedHTML = pasteArea.innerHTML;

      // DOMParserでHTMLをパースしてテーブル要素を探す
      const parser = new DOMParser();
      const doc = parser.parseFromString(pastedHTML, "text/html");
      const table = doc.querySelector("table");

      if (!table) {
        alert("テーブルが見つかりません。Excelからコピーされていない可能性があります。");
        return;
      }

      // テーブル内の<tr>を全て取得
      const rows = table.querySelectorAll("tr");
      const data = [];

      rows.forEach((row) => {
        const cells = row.querySelectorAll("td, th");
        const rowData = [];
        cells.forEach((cell) => {
          // セルのテキストを取り出して配列に格納
          rowData.push(cell.innerText.trim());
        });
        data.push(rowData);
      });

      console.log("Excel表を配列として取得:", data);
      alert("解析完了！コンソールを確認してください。");

      // ここで「data」を使ってシミュレーションロジックに反映する
      // 例: Canvas上にテキストを描画
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // テーブルの先頭行(見出し)を表示してみる例
      if (data.length > 0) {
        const headers = data[0].join(", ");
        ctx.fillStyle = "#000";
        ctx.font = "20px sans-serif";
        ctx.fillText("見出し: " + headers, 20, 40);
      }

      // 必要に応じて、実際の送迎シミュレーション処理をここに実装
      // ...
    });
  </script>
</body>
</html>
