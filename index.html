<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JSONPで所要時間取得</title>
</head>
<body>
  <label>出発地: <input id="origin"></label><br>
  <label>目的地: <input id="destination"></label><br>
  <button onclick="calcTime()">計算</button>
  
  <div id="result"></div>

  <script>
    // Apps Script のデプロイURL（末尾 /exec）
    const GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbx.../exec";

    // JSONP のコールバック関数名
    const CALLBACK_NAME = "myCallback";

    // JSONP コールバック
    function myCallback(data) {
      // data = {duration: "..."}
      if (data.duration) {
        document.getElementById("result").textContent = "所要時間: " + data.duration;
      } else {
        document.getElementById("result").textContent = "取得失敗";
      }
    }

    function calcTime() {
      const origin = document.getElementById("origin").value;
      const destination = document.getElementById("destination").value;
      if (!origin || !destination) {
        alert("出発地と目的地を入力してください");
        return;
      }
      
      // JSONP用のURL
      // 例: .../exec?origin=東京駅&destination=京都駅&callback=myCallback
      const url = GAS_ENDPOINT
        + "?origin=" + encodeURIComponent(origin)
        + "&destination=" + encodeURIComponent(destination)
        + "&callback=" + CALLBACK_NAME;

      // scriptタグを動的に生成して読み込む
      const script = document.createElement('script');
      script.src = url;
      // 前のリクエストのscriptタグが残ると連続アクセス時に不都合なので、都度削除
      script.onload = () => document.body.removeChild(script);
      document.body.appendChild(script);
      
      document.getElementById("result").textContent = "取得中...";
    }
  </script>
</body>
</html>
